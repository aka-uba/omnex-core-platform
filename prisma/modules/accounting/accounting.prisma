// ============================================
// Accounting Module
// ============================================

// Ödeme Yöntemleri Yapılandırması
model PaymentMethodConfig {
  id        String @id @default(uuid())
  tenantId  String
  companyId String

  // Temel bilgiler
  name        String // "Nakit", "Banka Havalesi", "Kredi Kartı" vb.
  code        String // 'cash', 'bank_transfer', 'card', 'check', 'other'
  description String?
  icon        String? // Icon adı

  // Banka hesap bilgileri (bank_transfer için)
  bankName      String?
  accountHolder String?
  iban          String?
  swiftCode     String?
  branchCode    String?
  accountNumber String?

  // Varsayılan ve sıralama
  isDefault  Boolean @default(false)
  sortOrder  Int     @default(0)
  isActive   Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([tenantId, companyId, code])
  @@index([tenantId, companyId])
  @@index([tenantId, companyId, isActive])
  @@index([isDefault])
  @@index([sortOrder])
}

// Gelir-Gider İşlemleri (Kasa hareketleri)
model CashTransaction {
  id        String @id @default(uuid())
  tenantId  String
  companyId String

  // İşlem bilgileri
  type            String // 'income', 'expense'
  category        String // 'rent', 'maintenance', 'salary', 'utility', 'other'
  amount          Decimal  @db.Decimal(10, 2)
  currency        String   @default("TRY")
  transactionDate DateTime

  // Ödeme yöntemi
  paymentMethod String // PaymentMethodConfig.code

  // İlişkili kayıtlar
  paymentId   String? // Real estate Payment ID
  expenseId   String? // Expense ID
  invoiceId   String? // Invoice ID

  // Açıklama ve notlar
  description String?
  reference   String? // Makbuz/Dekont numarası
  notes       String?

  // Durum
  status String @default("completed") // 'pending', 'completed', 'cancelled'

  // Metadata
  createdBy String? // User ID

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId, companyId])
  @@index([tenantId, companyId, type])
  @@index([tenantId, companyId, category])
  @@index([tenantId, companyId, transactionDate])
  @@index([paymentId])
  @@index([expenseId])
  @@index([invoiceId])
  @@index([type])
  @@index([category])
  @@index([transactionDate])
}

model Subscription {
  id        String @id @default(uuid())
  tenantId  String
  companyId String

  // Abonelik bilgileri
  name   String
  type   String // 'rental', 'subscription', 'commission'
  status String @default("active") // 'active', 'suspended', 'cancelled'

  // Müşteri/Tedarikçi
  customerId String? // Müşteri ID
  supplierId String? // Tedarikçi ID

  // Tarihler
  startDate   DateTime
  endDate     DateTime?
  renewalDate DateTime?

  // Fiyatlandırma
  basePrice    Decimal @db.Decimal(10, 2)
  currency     String  @default("TRY")
  billingCycle String // 'monthly', 'quarterly', 'yearly', 'one_time'

  // Komisyon (eğer varsa)
  commissionRate Decimal? @db.Decimal(5, 2)
  commissionType String? // 'percentage', 'fixed'

  // Personel atama
  assignedUserId String? // Personel ID

  // Metadata
  description String?
  terms       String?

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  invoices Invoice[]
  payments AccountingPayment[]
  expenses Expense[]

  @@index([tenantId, companyId])
  @@index([tenantId, companyId, status])
  @@index([tenantId, companyId, isActive])
  @@index([tenantId, companyId, type])
  @@index([customerId])
  @@index([supplierId])
  @@index([assignedUserId])
  @@index([status])
  @@index([type])
}

model Invoice {
  id             String  @id @default(uuid())
  tenantId       String
  companyId      String
  subscriptionId String?

  // Fatura bilgileri
  invoiceNumber String
  invoiceDate   DateTime
  dueDate       DateTime

  // Müşteri/Tedarikçi
  customerId String? // Müşteri ID
  supplierId String? // Tedarikçi ID

  // Tutar bilgileri
  subtotal    Decimal  @db.Decimal(10, 2)
  taxRate     Decimal? @db.Decimal(5, 2)
  taxAmount   Decimal? @db.Decimal(10, 2)
  totalAmount Decimal  @db.Decimal(10, 2)
  currency    String   @default("TRY")

  // Durum
  status   String    @default("draft") // 'draft', 'sent', 'paid', 'overdue', 'cancelled'
  paidDate DateTime?

  // Ödeme bilgileri
  paymentMethod String?
  paymentNotes  String?

  // Metadata
  description String?
  items       Json? // InvoiceItem[]
  documents   String[] // Merkezi Dosya Yönetimi'nden

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  subscription Subscription?       @relation(fields: [subscriptionId], references: [id])
  payments     AccountingPayment[]

  @@unique([tenantId, invoiceNumber])
  @@index([tenantId, companyId])
  @@index([tenantId, companyId, status])
  @@index([tenantId, companyId, isActive])
  @@index([tenantId, companyId, dueDate])
  @@index([subscriptionId])
  @@index([customerId])
  @@index([supplierId])
  @@index([status])
  @@index([invoiceNumber])
  @@index([invoiceDate])
}

model AccountingPayment {
  id             String  @id @default(uuid())
  tenantId       String
  companyId      String
  subscriptionId String?
  invoiceId      String?

  // Ödeme bilgileri
  amount      Decimal  @db.Decimal(10, 2)
  currency    String   @default("TRY")
  paymentDate DateTime

  // Ödeme yöntemi
  paymentMethod    String // 'cash', 'bank_transfer', 'card', 'check', 'other'
  paymentReference String? // Referans numarası

  // Durum
  status String @default("completed") // 'pending', 'completed', 'failed', 'cancelled'

  // Metadata
  notes      String?
  receiptUrl String? // Merkezi Dosya Yönetimi'nden

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  subscription Subscription? @relation(fields: [subscriptionId], references: [id])
  invoice      Invoice?      @relation(fields: [invoiceId], references: [id])

  @@index([tenantId, companyId])
  @@index([tenantId, companyId, status])
  @@index([tenantId, companyId, paymentDate])
  @@index([subscriptionId])
  @@index([invoiceId])
  @@index([status])
  @@index([paymentDate])
}

model Expense {
  id             String  @id @default(uuid())
  tenantId       String
  companyId      String
  locationId     String?
  subscriptionId String?

  // Gider bilgileri
  name     String
  category String
  type     String // 'operational', 'subscription', 'maintenance', 'rent', 'utility', 'other'
  amount   Decimal @db.Decimal(10, 2)
  currency String  @default("TRY")

  // Tarih
  expenseDate DateTime

  // Personel atama
  assignedUserId String?

  // Onay
  status     String    @default("pending") // 'pending', 'approved', 'rejected'
  approvedBy String?
  approvedAt DateTime?

  // Metadata
  description String?
  receiptUrl  String? // Merkezi Dosya Yönetimi'nden

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  subscription Subscription? @relation(fields: [subscriptionId], references: [id])

  @@index([tenantId, companyId])
  @@index([tenantId, companyId, status])
  @@index([tenantId, companyId, isActive])
  @@index([tenantId, companyId, expenseDate])
  @@index([tenantId, companyId, category])
  @@index([subscriptionId])
  @@index([locationId])
  @@index([assignedUserId])
  @@index([category])
  @@index([type])
  @@index([expenseDate])
  @@index([status])
}


















