// Tenant Database Schema
// Auto-generated from modular schemas - DO NOT EDIT MANUALLY
// Generated at: 2025-12-22T10:48:41.540Z
// 
// This file is automatically generated by scripts/merge-schemas.js
// Manual edits will be overwritten on next merge.

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/tenant-client"
}

datasource db {
  provider = "postgresql"
  url      = env("TENANT_DATABASE_URL")
}


// ============================================
// CORE BASE (Required for all tenants)
// ============================================

// From: core-base/user.prisma
// ============================================
// User Management
// ============================================

model User {
  id       String  @id @default(uuid())
  name     String
  username String? @unique
  email    String  @unique
  password String? // Hashed password
  role     String  @default("ClientUser") // SuperAdmin, AgencyUser, ClientUser
  status   String  @default("pending") // active, inactive, pending

  // Personal Information
  phone          String?
  profilePicture String?
  department     String?
  position       String?
  employeeId     String?
  hireDate       DateTime?

  // Contact Information
  address          String?
  city             String?
  country          String?
  postalCode       String?
  emergencyContact String?
  emergencyPhone   String?

  // Documents
  passportUrl    String?
  idCardUrl      String?
  contractUrl    String?
  cvUrl          String?
  otherDocuments Json? // Array of document URLs

  // Preferences
  defaultLanguage String? @default("tr")
  defaultTheme    String? @default("auto")
  defaultLayout   String? @default("sidebar")

  // Timestamps
  lastActive DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  // Relations
  companies             Company[]        @relation("CompanyUsers")
  userPreferences       UserPreferences?
  userPermissions       UserPermission[]
  aiGenerations         AIGeneration[]
  aiHistory             AIHistory[]
  sentNotifications     Notification[]   @relation("NotificationSender")
  receivedNotifications Notification[]   @relation("NotificationRecipient")
  reports               Report[]
  auditLogs             AuditLog[]
  employee              Employee?        @relation("EmployeeUser")
  bulkOperations        BulkOperation[]
  calendarEvents        CalendarEvent[]  @relation("CalendarEventUser")

  @@index([email])
  @@index([username])
  @@index([role])
  @@index([status])
}




// From: core-base/company.prisma
// ============================================
// Company (Tenant'ın İş Birimi)
// ============================================

model Company {
  id        String   @id @default(uuid())
  name      String
  industry  String?
  website   String?
  status    String   @default("Active") // Active, Archived
  
  // Kurumsal bilgiler (Template'ler için gerekli)
  logo             String? // Logo URL
  logoFile         String? // Logo dosya yolu
  address          String? // Adres
  city             String?
  state            String?
  postalCode       String?
  country          String?
  phone            String?
  email            String?
  taxNumber        String? // Vergi numarası
  taxOffice        String? // Vergi dairesi
  registrationNumber String? // Ticaret sicil numarası
  mersisNumber     String? // MERSIS numarası
  iban             String? // IBAN
  bankName         String? // Banka adı
  accountHolder    String? // Hesap sahibi
  
  // Ek bilgiler
  description      String? // Firma açıklaması
  foundedYear      Int? // Kuruluş yılı
  employeeCount    Int? // Çalışan sayısı
  capital          String? // Sermaye
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  users         User[]               @relation("CompanyUsers")
  brandKit      BrandKit?
  assets        Asset[]
  contents      Content[]
  finances      Finance[]
  aiGenerations AIGeneration[]
  aiHistory     AIHistory[]
  layoutConfig  CompanyLayoutConfig?
  websites      Website[]

  @@index([name])
  @@index([status])
}






// From: core-base/permissions.prisma
// ============================================
// Permission System
// ============================================

model PermissionDefinition {
  id             String   @id @default(uuid())
  tenantId       String
  companyId      String
  permissionKey  String   @unique // Format: "module.action"
  permissionName String
  description    String?
  category       String?
  module         String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  userPermissions UserPermission[]

  @@index([tenantId, companyId])
  @@index([permissionKey])
  @@index([category])
  @@index([module])
}

model UserPermission {
  id            String    @id @default(uuid())
  tenantId      String
  companyId     String
  userId        String
  permissionKey String
  granted       Boolean   @default(false)
  grantedBy     String?
  grantedAt     DateTime?
  expiresAt     DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  user       User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  permission PermissionDefinition @relation(fields: [permissionKey], references: [permissionKey], onDelete: Cascade)

  @@unique([userId, permissionKey])
  @@index([tenantId, companyId])
  @@index([userId])
  @@index([permissionKey])
  @@index([granted])
}

model PagePermission {
  id                  String   @id @default(uuid())
  tenantId            String
  companyId           String
  pageRoute           String   @unique
  pageName            String
  description         String?
  requiredRole        String? // SuperAdmin, AgencyUser, ClientUser
  requiredPermissions String[] // Array of permission keys
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@index([tenantId, companyId])
  @@index([pageRoute])
  @@index([requiredRole])
}

// ============================================
// Role System
// ============================================

model Role {
  id          String   @id @default(uuid())
  tenantId    String
  companyId   String
  name        String   @unique
  description String?
  permissions String[] // Array of permission keys
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  layoutConfig RoleLayoutConfig?

  @@index([tenantId, companyId])
  @@index([name])
}

// ============================================
// Layout Configuration Models (v2)
// ============================================

model RoleLayoutConfig {
  id         String   @id @default(uuid())
  tenantId   String
  companyId  String
  role       String   @unique // Role name
  layoutType String   @default("sidebar")
  config     Json? // Layout yapılandırması
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  roleRef Role @relation(fields: [role], references: [name], onDelete: Cascade)

  @@index([tenantId, companyId])
  @@index([role])
}

model CompanyLayoutConfig {
  id         String   @id @default(uuid())
  tenantId   String
  companyId  String   @unique
  layoutType String   @default("sidebar")
  config     Json? // Layout yapılandırması
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([tenantId, companyId])
}

// ============================================
// User Preferences
// ============================================

model UserPreferences {
  id                String  @id @default(uuid())
  tenantId          String
  companyId         String
  userId            String  @unique
  layoutType        String  @default("SidebarLayout") // SidebarLayout, TopLayout
  themeMode         String  @default("Auto") // Light, Dark, Auto
  direction         String  @default("LTR") // LTR, RTL
  locale            String  @default("tr")
  sidebarBackground String? // Color or preset name
  sidebarCollapsed  Boolean @default(false)
  sidebarWidth      Int?    @default(260) // px
  footerVisible     Boolean @default(true)
  topBarScroll      String? // fixed, hidden, hidden-on-hover
  menuColor         String? // light, dark
  customCss         String?
  preferences       Json? // Additional preferences (JSON)

  // Yeni layout ayarları (v2)
  layoutConfig      Json? // Tüm layout yapılandırması
  sidebarConfig     Json? // Sidebar özelleştirmeleri
  topConfig         Json? // Top layout özelleştirmeleri
  mobileConfig      Json? // Mobil özelleştirmeleri
  contentAreaConfig Json? // İçerik alanı ayarları
  layoutSource      String? // "role" | "user" | "company" | "default"

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId, companyId])
  @@index([userId])
}




// From: core-base/menu.prisma
// ============================================
// WordPress-Style Menu Management System
// ============================================

model Menu {
  id          String   @id @default(uuid())
  name        String   // Menu name (e.g., "Main Menu", "Footer Menu")
  slug        String   // URL-friendly identifier
  description String?
  locale      String   @default("tr") // Primary language
  tenantId    String?  // null for global menus
  companyId   String
  createdBy   String
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  items       MenuItem[]
  assignments MenuLocationAssignment[]
  
  @@unique([slug, tenantId, locale])
  @@index([tenantId])
  @@index([slug])
  @@index([isActive])
  @@map("menus")
}

model MenuItem {
  id          String   @id @default(uuid())
  tenantId   String
  companyId  String
  menuId      String
  parentId    String?  // For nested menus
  
  // Content (Multi-language support)
  label       Json     // { tr: "Ana Sayfa", en: "Home", de: "Startseite", ar: "الصفحة الرئيسية" }
  href        String
  icon        String?
  target      String?  // _blank, _self
  cssClass    String?
  description Json?    // Multi-language descriptions
  
  // Metadata
  order       Int      @default(0)
  visible     Boolean  @default(true)
  moduleSlug  String?  // Associated module
  menuGroup   String?  // "core", "admin", "user" - for visual grouping in UI
  
  // Permissions
  requiredRole       String?  // Minimum role required
  requiredPermission String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  menu        Menu       @relation(fields: [menuId], references: [id], onDelete: Cascade)
  parent      MenuItem?  @relation("MenuItemChildren", fields: [parentId], references: [id], onDelete: Cascade)
  children    MenuItem[] @relation("MenuItemChildren")
  
  @@index([tenantId, companyId])
  @@index([menuId])
  @@index([parentId])
  @@index([order])
  @@index([menuGroup])
  @@index([visible])
  @@map("menu_items")
}

model MenuLocation {
  id          String   @id @default(uuid())
  tenantId    String?  // nullable for global locations
  companyId   String
  name        String   // "sidebar", "top", "mobile", "footer", "footer-secondary"
  label       Json     // { tr: "Kenar Menü", en: "Sidebar Menu" }
  description String?
  layoutType  String   // "sidebar", "top", "both"
  maxDepth    Int      @default(3) // Maximum nesting level
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  assignments MenuLocationAssignment[]
  
  @@unique([name, tenantId])
  @@index([tenantId, companyId])
  @@index([layoutType])
  @@map("menu_locations")
}

model MenuLocationAssignment {
  id          String   @id @default(uuid())
  locationId  String
  menuId      String
  tenantId    String?
  companyId   String
  
  // Assignment scope (priority: user > role > branch > default)
  assignmentType String  // "default", "role", "user", "branch"
  assignmentId   String? // roleId, userId, or branchId
  
  priority    Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  location    MenuLocation @relation(fields: [locationId], references: [id], onDelete: Cascade)
  menu        Menu         @relation(fields: [menuId], references: [id], onDelete: Cascade)
  
  @@unique([locationId, assignmentType, assignmentId, tenantId])
  @@index([locationId])
  @@index([menuId])
  @@index([assignmentType, assignmentId])
  @@index([tenantId, companyId])
  @@index([isActive])
  @@map("menu_location_assignments")
}

model FooterCustomization {
  id          String   @id @default(uuid())
  tenantId    String   @unique
  companyId   String
  
  // Company info
  companyName      String?
  companyNameMode  String  @default("dynamic") // "dynamic" or "custom"
  logo             String? // Logo URL
  description      Json?   // Multi-language
  
  // Contact info
  address          Json?   // Multi-language
  phone            String?
  email            String?
  
  // Social links
  socialLinks      Json?   // { facebook: "url", twitter: "url", linkedin: "url", instagram: "url" }
  
  // Layout
  showCopyright    Boolean @default(true)
  copyrightText    Json?   // Multi-language (backward compatibility - can be string or object)
  
  // Menus
  primaryMenuId       String? // Main footer menu
  
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([tenantId, companyId])
  @@map("footer_customizations")
}

model LicenseNotification {
  id        String @id @default(uuid())
  tenantId  String
  companyId String
  licenseId String // Core DB'den referans

  type      String // 'expiring_soon', 'expired', 'payment_required'
  message   String
  actionUrl String?

  isRead Boolean   @default(false)
  readAt DateTime?

  createdAt DateTime @default(now())

  @@index([tenantId, companyId])
  @@index([licenseId])
  @@index([isRead])
}

model AccessControlConfiguration {
  id       String @id @default(uuid())
  tenantId String
  companyId String

  // Scope (priority: user > role > tenant)
  userId String?
  roleId String?

  // Configuration type: 'module' | 'menu' | 'ui' | 'layout'
  type String

  // Configuration data (flexible JSON structure)
  // Module: { "ai": { "enabled": true, "features": ["text", "code"] } }
  // Menu: { "items": [{ "id": "dashboard", "visible": true, "order": 0 }] }
  // UI: { "buttons": { "create": true, "edit": true }, "features": { "bulkActions": true } }
  // Layout: { "sidebar": { "width": 280, "background": "brand" }, "contentArea": { "maxWidth": 1200 } }
  config Json

  isActive Boolean @default(true)

  createdBy String
  updatedBy String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId, companyId, type])
  @@index([userId])
  @@index([roleId])
  @@index([isActive])
}

model GeneralSettings {
  id          String   @id @default(uuid())
  tenantId    String
  companyId   String
  
  // ============================================
  // 1. Region and Time Settings
  // ============================================
  timezone            String   @default("Europe/Istanbul") // Timezone (UTC offset)
  dateFormat          String   @default("DD/MM/YYYY") // DD/MM/YYYY, MM/DD/YYYY, YYYY-MM-DD
  timeFormat          String   @default("24") // "12" (AM/PM) or "24" (24-hour)
  weekStart           String   @default("monday") // "monday" or "sunday"
  currency            String   @default("TRY") // TRY, USD, EUR, GBP, etc.
  defaultLanguage     String   @default("tr") // tr, en, de, ar
  
  // ============================================
  // 2. Email (SMTP) Settings
  // ============================================
  smtpHost            String?
  smtpPort            Int?     @default(587)
  smtpEncryption      String?  @default("TLS") // TLS, SSL, None
  smtpUsername        String?
  smtpPassword        String?  // Encrypted password
  smtpFromName        String?
  smtpFromEmail       String?
  smtpTimeout         Int?     @default(30000) // milliseconds
  smtpRetryAttempts   Int?     @default(3)
  smtpConnectionPool  Int?     @default(5)
  smtpEnabled         Boolean  @default(false)
  
  // ============================================
  // 3. Calendar Integration
  // ============================================
  calendarIntegrations Json?   // { google: { enabled, apiKey, calendarId, syncInterval }, outlook: {...}, icloud: {...}, yandex: {...} }
  calendarDefaultView  String? @default("month") // month, week, day
  calendarShowWeekends Boolean @default(true)
  calendarShowHolidays Boolean @default(true)
  
  // ============================================
  // 4. Security Settings
  // ============================================
  sessionTimeout          Int?     @default(30) // minutes
  maxConcurrentSessions   Int?     @default(5)
  rememberMeDuration      Int?     @default(30) // days
  
  // Password Policy
  passwordMinLength       Int?     @default(8)
  passwordRequireUppercase Boolean @default(true)
  passwordRequireLowercase Boolean @default(true)
  passwordRequireNumbers   Boolean @default(true)
  passwordRequireSpecial   Boolean @default(false)
  passwordExpirationDays   Int?     // null = no expiration
  
  // Two-Factor Authentication (2FA)
  twoFactorEnabled        Boolean  @default(false)
  twoFactorRequiredForAdmins Boolean @default(false)
  twoFactorBackupCodes    Json?    // Array of backup codes
  
  // Login Security
  maxLoginAttempts         Int?     @default(5)
  lockoutDuration          Int?     @default(15) // minutes
  ipWhitelist              Json?    // Array of IP addresses
  
  // API Security
  apiRateLimit             Int?     @default(100) // requests per minute
  apiKeyExpiration         Int?     // days, null = no expiration
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([tenantId, companyId])
  @@index([tenantId, companyId])
  @@map("general_settings")
}

model NotificationSettings {
  id          String   @id @default(uuid())
  tenantId    String
  companyId   String
  userId      String?  // null for tenant/company level settings
  
  // ============================================
  // 1. Email Notifications
  // ============================================
  emailEnabled            Boolean  @default(true)
  emailSystemNotifications Boolean @default(true)
  emailUserNotifications   Boolean @default(true)
  emailModuleNotifications Json?   // { moduleSlug: { enabled: boolean, types: string[] } }
  
  // ============================================
  // 2. Push Notifications
  // ============================================
  pushEnabled            Boolean  @default(true)
  pushBrowserEnabled     Boolean  @default(true)
  pushMobileEnabled      Boolean  @default(false)
  pushSystemNotifications Boolean @default(true)
  pushUserNotifications   Boolean @default(true)
  pushModuleNotifications Json?   // { moduleSlug: { enabled: boolean, types: string[] } }
  
  // ============================================
  // 3. SMS Notifications
  // ============================================
  smsEnabled            Boolean  @default(false)
  smsProvider           String?  // "twilio", "nexmo", "custom"
  smsApiKey             String?  // Encrypted API key
  smsApiSecret          String?  // Encrypted API secret
  smsFromNumber         String?
  smsSystemNotifications Boolean @default(false)
  smsUserNotifications   Boolean @default(false)
  smsModuleNotifications Json?   // { moduleSlug: { enabled: boolean, types: string[] } }
  
  // ============================================
  // 4. Notification Preferences
  // ============================================
  reminderTime          Int?     @default(15) // minutes before reminder
  quietHoursStart       String?  // "HH:mm" format, e.g., "22:00"
  quietHoursEnd         String?  // "HH:mm" format, e.g., "08:00"
  notificationSound     Boolean  @default(true)
  notificationSoundFile String?  // URL to sound file
  
  // ============================================
  // 5. Module Notification Settings
  // ============================================
  moduleSettings        Json?    // { moduleSlug: { enabled: boolean, channels: { email: boolean, push: boolean, sms: boolean }, types: { typeName: { enabled: boolean, channels: {...} } } } }
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([tenantId, companyId, userId])
  @@index([tenantId, companyId])
  @@index([userId])
  @@map("notification_settings")
}




// ============================================
// EXTENSIONS (Cross-cutting concerns)
// ============================================

// From: extensions/ai.prisma
// ============================================
// AI System
// ============================================

model AIGeneration {
  id            String   @id @default(uuid())
  tenantId      String
  userId        String
  companyId     String?
  generatorType String // text, code, image, voice, video
  prompt        String   @db.Text
  output        String?  @db.Text // text/url/json
  settings      Json? // Generation settings
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  company Company? @relation(fields: [companyId], references: [id], onDelete: SetNull)

  @@index([tenantId])
  @@index([userId])
  @@index([companyId])
  @@index([generatorType])
  @@index([createdAt])
}

model AIHistory {
  id            String   @id @default(uuid())
  tenantId      String
  userId        String
  companyId     String?
  generatorType String // text, code, image, voice, video
  prompt        String   @db.Text
  outputUrl     String?
  metadata      Json? // Additional metadata
  createdAt     DateTime @default(now())

  // Relations
  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  company Company? @relation(fields: [companyId], references: [id], onDelete: SetNull)

  @@index([tenantId])
  @@index([userId])
  @@index([companyId])
  @@index([generatorType])
  @@index([createdAt])
}




// From: extensions/audit.prisma
// ============================================
// Audit Log / Activity Timeline
// ============================================

model AuditLog {
  id        String   @id @default(cuid())
  tenantId  String
  companyId String
  userId    String? // User ID (nullable for system actions)
  action    String // create, update, delete, login, logout, export, import, etc.
  entity    String // User, Notification, Report, Company, Module, Settings, etc.
  entityId  String? // ID of the affected entity
  metadata  Json? // Additional context: { oldValue, newValue, ip, userAgent, etc. }
  ipAddress String? // IP address
  userAgent String? // Browser/client info
  createdAt DateTime @default(now())

  // Relations
  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([tenantId, companyId])
  @@index([userId])
  @@index([action])
  @@index([entity])
  @@index([entityId])
  @@index([createdAt])
}




// From: extensions/files.prisma
// ============================================
// Core File Management System (FAZ 0.1)
// ============================================

model CoreFile {
  id         String  @id @default(uuid())
  tenantId   String
  companyId  String
  module     String // 'accounting', 'notifications', 'hr', 'maintenance', etc.
  entityType String? // 'invoice', 'contract', 'maintenance-report', etc.
  entityId   String? // İlişkili entity ID

  // Dosya bilgileri
  filename     String
  originalName String
  path         String // Relative path: "accounting/invoices/2024/01/"
  fullPath     String // Full path: "tenants/{tenantId}/module-files/accounting/invoices/..."
  size         Int
  mimeType     String
  extension    String

  // Metadata
  title       String?
  description String?
  tags        String[] // Array of tag strings
  category    String?

  // Versiyon kontrolü
  version           Int     @default(1)
  isLatest          Boolean @default(true)
  previousVersionId String?

  // Erişim kontrolü
  permissions Json // FilePermissions: { read: string[], write: string[], delete: string[], share: string[], isPublic: boolean }
  createdBy   String
  updatedBy   String

  // Audit
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  accessedAt DateTime?

  // Relations
  shares          FileShare[]
  versions        CoreFile[]  @relation("FileVersions")
  previousVersion CoreFile?   @relation("FileVersions", fields: [previousVersionId], references: [id])

  @@index([tenantId, companyId, module])
  @@index([module, entityType, entityId])
  @@index([createdBy])
  @@index([isLatest])
}

model FileShare {
  id            String    @id @default(uuid())
  tenantId      String
  companyId     String
  fileId        String
  sharedBy      String
  sharedWith    String // user/role ID veya 'public'
  permission    String // 'view' | 'download' | 'edit'
  expiresAt     DateTime?
  accessCode    String? // Güvenli paylaşım için
  downloadCount Int       @default(0)
  createdAt     DateTime  @default(now())

  // Relations
  file CoreFile @relation(fields: [fileId], references: [id], onDelete: Cascade)

  @@index([tenantId, companyId])
  @@index([fileId])
  @@index([sharedWith])
  @@index([expiresAt])
}

// ============================================
// Dynamic Form Builder System (FAZ 0.5)
// ============================================

model FormConfig {
  id         String @id @default(uuid())
  tenantId   String
  companyId  String
  module     String
  entityType String
  name       String

  // Form alanları
  fields Json // FormField[]

  // Versiyon kontrolü
  version Int @default(1)

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId, companyId, module, entityType])
  @@index([module, entityType])
  @@index([isActive])
}

// ============================================
// Export Template System (FAZ 0.3)
// ============================================

model ExportTemplate {
  id         String  @id @default(uuid())
  tenantId   String
  companyId  String?
  locationId String?
  name       String
  type       String // 'header' | 'footer' | 'full' | 'email' | 'sms' | 'push'
  category   String? // 'export' | 'notification' - export için export, bildirimler için notification
  description String? // Template açıklaması

  // Template içeriği
  logoUrl      String?
  title        String?
  subtitle     String?
  address      String?
  phone        String?
  email        String?
  website      String?
  taxNumber    String?
  customFields Json? // Additional custom fields

  // Düzen ayarları
  layout Json? // CSS-like layout config: { header: {...}, footer: {...}, body: {...} }
  styles Json? // Styling options: { colors: {...}, fonts: {...}, spacing: {...} }
  design Json? // Template design structure (HTML-like structure for rendering)
  
  // Preview ve versiyonlama
  previewImage String? // Preview görseli URL
  version      Int     @default(1) // Template versiyonu
  isPublished  Boolean @default(true) // Yayınlanmış mı?

  // Import/Export metadata
  exportedAt   DateTime? // Son export tarihi
  importedAt   DateTime? // Son import tarihi
  sourceTemplateId String? // Import edildiyse kaynak template ID

  isDefault Boolean @default(false)
  isActive  Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId, companyId])
  @@index([type])
  @@index([category])
  @@index([isDefault])
  @@index([isActive])
  @@index([isPublished])
}

// ============================================
// Notification Template System (FAZ 0.4)
// ============================================

model NotificationTemplate {
  id         String  @id @default(uuid())
  tenantId   String
  companyId  String?
  locationId String?
  
  // Template bilgileri
  name        String
  channel     String // 'email' | 'sms' | 'push' | 'whatsapp' | 'telegram'
  category    String? // 'system' | 'user' | 'task' | 'urgent' | 'custom'
  notificationType String? // Bildirim tipi: 'task_assignment', 'urgent_alert', 'system_update', vb.
  description String?
  
  // Email özel alanlar
  emailSubject      String? // Email konu başlığı
  emailPlainText    String? // Düz metin içerik
  emailHtmlTemplate String? // HTML template içeriği
  emailTemplateStyle String? // 'corporate' | 'visionary' | 'elegant' | 'modern'
  
  // Email imza alanı
  emailSignatureEnabled Boolean @default(true)
  emailSignatureUserInfo Boolean @default(true) // Kullanıcı bilgileri göster
  emailSignatureUserAvatar Boolean @default(true) // Kullanıcı avatarı göster
  emailSignatureCompanyLogo Boolean @default(true) // Firma logosu göster
  emailSignatureCompanyInfo Boolean @default(true) // Firma bilgileri göster
  
  // SMS özel alanlar
  smsSubject String? // SMS konu başlığı (bazı provider'lar destekler)
  smsContent String? // SMS içeriği
  
  // WhatsApp/Telegram özel alanlar
  socialImageUrl String? // Resim URL'i
  socialImageDescription String? // Resim açıklaması
  socialContent String? // Mesaj içeriği
  
  // Push notification özel alanlar
  pushTitle String? // Push başlık
  pushBody  String? // Push içerik
  pushIcon  String? // Push ikon URL'i
  pushImage String? // Push görsel URL'i
  
  // Varsayılan mesaj alanları (Email için)
  defaultMessagePrefix String? // İlk metin
  defaultMessageSuffix String? // Son metin
  
  // Template içeriği (JSON formatında dinamik değişkenler)
  templateVariables Json? // Kullanılabilir değişkenler: {{userName}}, {{companyName}}, vb.
  templateContent  Json? // Template içeriği yapısı
  
  // Dinamik değişkenler
  variables Json? // { userName: "Kullanıcı Adı", companyLogo: "Logo URL", companyInfo: {...} }
  
  // Tasarım ayarları
  designStyle String? // 'corporate' | 'visionary' | 'elegant' | 'modern' | 'minimal'
  layout      Json? // Layout ayarları
  styles      Json? // Stil ayarları (renkler, fontlar, vb.)
  
  // Durum
  isDefault Boolean @default(false)
  isActive  Boolean @default(true)
  isPublished Boolean @default(true)
  
  // Versiyonlama
  version Int @default(1)
  
  // Metadata
  previewImage String? // Önizleme görseli
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([tenantId, companyId])
  @@index([channel])
  @@index([category])
  @@index([notificationType])
  @@index([isDefault])
  @@index([isActive])
  @@map("notification_templates")
}




// From: extensions/meta.prisma
// ============================================
// Entity Meta (Speculative Fields)
// ============================================
// 
// Use this table for "speculative fields" - fields that might be needed
// in the future but aren't part of the core schema yet.
// 
// Example usage:
// - Experimental features
// - A/B testing data
// - Module-specific custom fields
// - Future-proofing without schema bloat

model EntityMeta {
  id         String @id @default(uuid())
  tenantId   String
  companyId  String
  entityType String // e.g., "Property", "Invoice", "Employee"
  entityId   String // ID of the entity
  key        String // Field name
  value      Json   // Field value (flexible JSON)

  @@unique([tenantId, entityType, entityId, key])
  @@index([tenantId, entityType, entityId])
  @@index([tenantId, companyId])
}





















// From: extensions/notifications.prisma
// ============================================
// Notification System
// ============================================

model Notification {
  id          String    @id @default(uuid())
  tenantId    String
  companyId   String
  title       String
  message     String    @db.Text
  type        String    @default("info") // info, warning, error, success, task, alert
  priority    String    @default("medium") // low, medium, high, urgent
  senderId    String?
  recipientId String?
  locationId  String?
  isRead      Boolean   @default(false)
  readAt      DateTime?
  isGlobal    Boolean   @default(false)
  expiresAt   DateTime?
  data        Json? // Additional data
  actionUrl   String?
  actionText  String?
  module      String?
  archivedAt  DateTime?
  status      String? // Computed: read, unread, archived
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  sender      User?        @relation("NotificationSender", fields: [senderId], references: [id], onDelete: SetNull)
  recipient   User?        @relation("NotificationRecipient", fields: [recipientId], references: [id], onDelete: SetNull)
  attachments Attachment[]

  @@index([tenantId, companyId])
  @@index([senderId])
  @@index([recipientId])
  @@index([isRead])
  @@index([status])
  @@index([isGlobal])
  @@index([type])
  @@index([module])
  @@index([archivedAt])
  @@index([createdAt])
}

model Attachment {
  id             String   @id @default(uuid())
  tenantId       String
  notificationId String
  url            String
  filename       String
  contentType    String?
  size           Int? // File size in bytes
  companyId      String?
  createdAt      DateTime @default(now())

  // Relations
  notification Notification @relation(fields: [notificationId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([notificationId])
  @@index([companyId])
}

// ============================================
// Report System
// ============================================

model Report {
  id            String    @id @default(uuid())
  tenantId      String
  companyId     String
  userId        String
  name          String
  reportType    String
  description   String?
  dateRange     Json? // { start: Date, end: Date }
  filters       Json? // Additional filters
  visualization String? // table, bar, line, pie, area
  status        String    @default("pending") // pending, completed, failed, generating
  outputUrl     String?
  errorMessage  String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  completedAt   DateTime?

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId, companyId])
  @@index([userId])
  @@index([reportType])
  @@index([status])
  @@index([createdAt])
}




// From: extensions/schema-registry.prisma
// ============================================
// Schema Version Registry
// ============================================
// 
// Tracks the schema version for each tenant database.
// Used to prevent migration chaos in production.

model TenantSchemaRegistry {
  id        String   @id @default(uuid())
  tenantId  String   @unique
  companyId String
  version   String   // v1.4.2 format (SemVer)
  modules   String[] // Active module versions
  appliedAt DateTime @default(now())
  checksum  String?  // Schema integrity checksum

  @@index([version])
}




// ============================================
// MODULES (Module-specific schemas)
// ============================================

// From: modules/accounting/accounting.prisma
// ============================================
// Accounting Module
// ============================================

model Subscription {
  id        String @id @default(uuid())
  tenantId  String
  companyId String

  // Abonelik bilgileri
  name   String
  type   String // 'rental', 'subscription', 'commission'
  status String @default("active") // 'active', 'suspended', 'cancelled'

  // Müşteri/Tedarikçi
  customerId String? // Müşteri ID
  supplierId String? // Tedarikçi ID

  // Tarihler
  startDate   DateTime
  endDate     DateTime?
  renewalDate DateTime?

  // Fiyatlandırma
  basePrice    Decimal @db.Decimal(10, 2)
  currency     String  @default("TRY")
  billingCycle String // 'monthly', 'quarterly', 'yearly', 'one_time'

  // Komisyon (eğer varsa)
  commissionRate Decimal? @db.Decimal(5, 2)
  commissionType String? // 'percentage', 'fixed'

  // Personel atama
  assignedUserId String? // Personel ID

  // Metadata
  description String?
  terms       String?

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  invoices Invoice[]
  payments AccountingPayment[]
  expenses Expense[]

  @@index([tenantId, companyId])
  @@index([tenantId, companyId, status])
  @@index([tenantId, companyId, isActive])
  @@index([tenantId, companyId, type])
  @@index([customerId])
  @@index([supplierId])
  @@index([assignedUserId])
  @@index([status])
  @@index([type])
}

model Invoice {
  id             String  @id @default(uuid())
  tenantId       String
  companyId      String
  subscriptionId String?

  // Fatura bilgileri
  invoiceNumber String
  invoiceDate   DateTime
  dueDate       DateTime

  // Müşteri/Tedarikçi
  customerId String? // Müşteri ID
  supplierId String? // Tedarikçi ID

  // Tutar bilgileri
  subtotal    Decimal  @db.Decimal(10, 2)
  taxRate     Decimal? @db.Decimal(5, 2)
  taxAmount   Decimal? @db.Decimal(10, 2)
  totalAmount Decimal  @db.Decimal(10, 2)
  currency    String   @default("TRY")

  // Durum
  status   String    @default("draft") // 'draft', 'sent', 'paid', 'overdue', 'cancelled'
  paidDate DateTime?

  // Ödeme bilgileri
  paymentMethod String?
  paymentNotes  String?

  // Metadata
  description String?
  items       Json? // InvoiceItem[]
  documents   String[] // Merkezi Dosya Yönetimi'nden

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  subscription Subscription?       @relation(fields: [subscriptionId], references: [id])
  payments     AccountingPayment[]

  @@unique([tenantId, invoiceNumber])
  @@index([tenantId, companyId])
  @@index([tenantId, companyId, status])
  @@index([tenantId, companyId, isActive])
  @@index([tenantId, companyId, dueDate])
  @@index([subscriptionId])
  @@index([customerId])
  @@index([supplierId])
  @@index([status])
  @@index([invoiceNumber])
  @@index([invoiceDate])
}

model AccountingPayment {
  id             String  @id @default(uuid())
  tenantId       String
  companyId      String
  subscriptionId String?
  invoiceId      String?

  // Ödeme bilgileri
  amount      Decimal  @db.Decimal(10, 2)
  currency    String   @default("TRY")
  paymentDate DateTime

  // Ödeme yöntemi
  paymentMethod    String // 'cash', 'bank_transfer', 'card', 'check', 'other'
  paymentReference String? // Referans numarası

  // Durum
  status String @default("completed") // 'pending', 'completed', 'failed', 'cancelled'

  // Metadata
  notes      String?
  receiptUrl String? // Merkezi Dosya Yönetimi'nden

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  subscription Subscription? @relation(fields: [subscriptionId], references: [id])
  invoice      Invoice?      @relation(fields: [invoiceId], references: [id])

  @@index([tenantId, companyId])
  @@index([tenantId, companyId, status])
  @@index([tenantId, companyId, paymentDate])
  @@index([subscriptionId])
  @@index([invoiceId])
  @@index([status])
  @@index([paymentDate])
}

model Expense {
  id             String  @id @default(uuid())
  tenantId       String
  companyId      String
  locationId     String?
  subscriptionId String?

  // Gider bilgileri
  name     String
  category String
  type     String // 'operational', 'subscription', 'maintenance', 'rent', 'utility', 'other'
  amount   Decimal @db.Decimal(10, 2)
  currency String  @default("TRY")

  // Tarih
  expenseDate DateTime

  // Personel atama
  assignedUserId String?

  // Onay
  status     String    @default("pending") // 'pending', 'approved', 'rejected'
  approvedBy String?
  approvedAt DateTime?

  // Metadata
  description String?
  receiptUrl  String? // Merkezi Dosya Yönetimi'nden

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  subscription Subscription? @relation(fields: [subscriptionId], references: [id])

  @@index([tenantId, companyId])
  @@index([tenantId, companyId, status])
  @@index([tenantId, companyId, isActive])
  @@index([tenantId, companyId, expenseDate])
  @@index([tenantId, companyId, category])
  @@index([subscriptionId])
  @@index([locationId])
  @@index([assignedUserId])
  @@index([category])
  @@index([type])
  @@index([expenseDate])
  @@index([status])
}





















// From: modules/calendar/calendar.prisma
// ============================================
// Calendar Module
// ============================================

model CalendarEvent {
  id        String  @id @default(uuid())
  tenantId  String
  companyId String

  // Temel bilgiler
  title       String
  description String? @db.Text
  date        DateTime

  // İlişkili bilgiler
  client     String? // Müşteri adı veya ID
  status     String   @default("scheduled") // 'draft', 'scheduled', 'published', 'needs-revision', 'cancelled'
  color      String?  @default("blue") // 'yellow', 'green', 'red', 'blue', 'purple', 'slate'
  locationId String? // Real Estate modülündeki Location ID (string olarak, relation yok)

  // Kullanıcı ilişkisi (cross-cutting concern)
  userId String? // Event creator/owner

  // Modül ilişkisi
  module String? // İlişkili modül (e.g., 'real-estate', 'maintenance', 'hr')

  // Metadata
  metadata Json? // Ek veriler

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user User? @relation("CalendarEventUser", fields: [userId], references: [id], onDelete: SetNull)

  @@index([tenantId, companyId])
  @@index([userId])
  @@index([locationId])
  @@index([date])
  @@index([status])
  @@index([module])
  @@index([createdAt])
}


















// From: modules/chat/chat.prisma
// ============================================
// Chat Module
// ============================================

model ChatRoom {
  id        String @id @default(uuid())
  tenantId  String
  companyId String

  name String?
  type String  @default("direct") // 'direct', 'group', 'channel'

  // Katılımcılar
  participants String[] // User IDs

  // Metadata
  description String?
  avatarUrl   String?

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  messages ChatMessage[]

  @@index([tenantId, companyId])
  @@index([participants])
}

model ChatMessage {
  id        String @id @default(uuid())
  tenantId  String
  companyId String
  roomId    String
  senderId  String

  content String
  type    String @default("text") // 'text', 'file', 'image', 'system'

  // Dosya (eğer varsa)
  fileId   String? // Merkezi Dosya Yönetimi'nden
  fileName String?
  fileSize Int?
  fileType String?

  // Durum
  isRead Boolean   @default(false)
  readAt DateTime?

  // Metadata
  metadata Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  room ChatRoom @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@index([tenantId, companyId])
  @@index([roomId])
  @@index([senderId])
  @@index([createdAt])
}




// From: modules/hr/hr.prisma
// ============================================
// Human Resources Module
// ============================================

model Employee {
  id        String @id @default(uuid())
  userId    String @unique // User tablosuna referans
  tenantId  String
  companyId String

  // İş bilgileri
  employeeNumber String
  department     String
  position       String
  hireDate       DateTime
  managerId      String? // User ID

  // Maaş bilgileri
  salary      Decimal? @db.Decimal(10, 2)
  salaryGroup String?
  currency    String   @default("TRY")

  // Çalışma şekli
  workType String // 'full_time', 'part_time', 'contract'

  // Metadata
  metadata Json?

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user         User       @relation("EmployeeUser", fields: [userId], references: [id], onDelete: Cascade)
  manager      Employee?  @relation("EmployeeManager", fields: [managerId], references: [id], onDelete: SetNull)
  subordinates Employee[] @relation("EmployeeManager")
  leaves       Leave[]
  payrolls     Payroll[]

  @@index([tenantId, companyId])
  @@index([department])
  @@index([managerId])
  @@index([employeeNumber])
  @@index([isActive])
}

model Leave {
  id         String @id @default(uuid())
  tenantId   String
  companyId  String
  employeeId String

  type      String // 'annual', 'sick', 'unpaid', 'maternity'
  startDate DateTime
  endDate   DateTime
  days      Int

  // Durum
  status     String    @default("pending") // 'pending', 'approved', 'rejected'
  approvedBy String? // User ID
  approvedAt DateTime?

  // Metadata
  reason String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([tenantId, companyId])
  @@index([employeeId])
  @@index([status])
  @@index([startDate])
  @@index([endDate])
}

model Payroll {
  id         String @id @default(uuid())
  tenantId   String
  companyId  String
  employeeId String

  // Dönem
  period  String // 'YYYY-MM' formatında
  payDate DateTime

  // Maaş bilgileri
  grossSalary Decimal @db.Decimal(10, 2)
  deductions  Decimal @default(0) @db.Decimal(10, 2)
  netSalary   Decimal @db.Decimal(10, 2)

  // Kesintiler detayı
  taxDeduction    Decimal? @db.Decimal(10, 2)
  sgkDeduction    Decimal? @db.Decimal(10, 2)
  otherDeductions Decimal? @db.Decimal(10, 2)

  // Ödemeler
  bonuses  Decimal @default(0) @db.Decimal(10, 2)
  overtime Decimal @default(0) @db.Decimal(10, 2)

  // Durum
  status String @default("draft") // 'draft', 'approved', 'paid'

  // Metadata
  notes String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@index([tenantId, companyId])
  @@index([employeeId])
  @@index([period])
  @@index([status])
  @@index([payDate])
}





















// From: modules/maintenance/maintenance.prisma
// ============================================
// Maintenance Module
// ============================================

model Equipment {
  id         String  @id @default(uuid())
  tenantId   String
  companyId  String
  locationId String?

  name         String
  code         String?
  category     String // 'makine', 'elektronik', 'arac', etc.
  type         String
  brand        String?
  model        String?
  serialNumber String?

  // Özellikler (dinamik)
  attributes Json?

  // Durum
  status String @default("active") // 'active', 'maintenance', 'inactive'

  // Metadata
  description   String?
  purchaseDate  DateTime?
  warrantyUntil DateTime?

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  location           Location?           @relation(fields: [locationId], references: [id], onDelete: SetNull)
  maintenanceRecords MaintenanceRecord[]

  @@index([tenantId, companyId])
  @@index([locationId])
  @@index([category])
  @@index([status])
  @@index([isActive])
}

model EquipmentTemplate {
  id        String  @id @default(uuid())
  tenantId  String
  companyId String?

  name     String
  category String
  type     String

  // Template özellikleri
  attributes      Json // EquipmentAttribute[]
  defaultValues   Json?
  requiredFields  String[]
  validationRules Json?

  // İzin verilen lokasyon tipleri
  allowedLocationTypes String[]

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId, companyId])
  @@index([category])
  @@index([isActive])
}

model MaintenanceRecord {
  id          String @id @default(uuid())
  tenantId    String
  companyId   String
  locationId  String
  equipmentId String

  // Bakım bilgileri
  type        String // 'preventive', 'corrective', 'emergency'
  title       String
  description String?

  // Durum
  status String @default("scheduled") // 'scheduled', 'in_progress', 'completed', 'cancelled'

  // Tarihler
  scheduledDate DateTime
  startDate     DateTime?
  endDate       DateTime?

  // Personel
  assignedTo  String? // User ID
  performedBy String? // User ID

  // Maliyet
  estimatedCost Decimal?
  actualCost    Decimal?

  // Metadata
  notes     String?
  documents String[] // Merkezi Dosya Yönetimi'nden

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  location  Location  @relation(fields: [locationId], references: [id], onDelete: Cascade)
  equipment Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade)

  @@index([tenantId, companyId])
  @@index([locationId])
  @@index([equipmentId])
  @@index([status])
  @@index([scheduledDate])
}





















// From: modules/production/production.prisma
// ============================================
// Production Module
// ============================================

model Product {
  id         String  @id @default(uuid())
  tenantId   String
  companyId  String
  locationId String? // Üretim lokasyonu

  // Temel bilgiler
  name     String
  code     String
  sku      String?
  barcode  String?
  category String
  type     String // 'hammadde', 'yarı_mamul', 'mamul'

  // Stok bilgileri
  stockQuantity Decimal  @default(0) @db.Decimal(10, 2)
  minStockLevel Decimal? @db.Decimal(10, 2)
  maxStockLevel Decimal? @db.Decimal(10, 2)
  unit          String // 'adet', 'kg', 'lt', etc.

  // Maliyet bilgileri
  costPrice    Decimal? @db.Decimal(10, 2)
  sellingPrice Decimal? @db.Decimal(10, 2)
  currency     String   @default("TRY")

  // Üretim bilgileri
  isProducible   Boolean @default(false)
  productionTime Int? // Dakika cinsinden

  // Metadata
  description    String?
  specifications Json?
  images         String[] // Merkezi Dosya Yönetimi'nden

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  location         Location?         @relation(fields: [locationId], references: [id])
  bomItems         BOMItem[]         @relation("ProductBOM")
  bomProducts      BOMItem[]         @relation("BOMProduct")
  productionOrders ProductionOrder[]
  stockMovements   StockMovement[]

  @@unique([tenantId, code])
  @@index([tenantId, companyId])
  @@index([tenantId, companyId, isActive])
  @@index([tenantId, companyId, category])
  @@index([tenantId, companyId, type])
  @@index([locationId])
  @@index([category])
  @@index([type])
  @@index([code])
}

model BOMItem {
  id          String  @id @default(uuid())
  tenantId    String
  companyId   String
  bomId       String // BOM (Bill of Materials) ID
  productId   String // Ürün
  componentId String? // Bileşen ürün (eğer varsa)

  quantity  Decimal @db.Decimal(10, 2)
  unit      String
  wasteRate Decimal @default(0) @db.Decimal(5, 2) // Fire oranı

  // Sıralama
  order Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  product   Product  @relation("ProductBOM", fields: [productId], references: [id])
  component Product? @relation("BOMProduct", fields: [componentId], references: [id])

  @@index([tenantId, companyId])
  @@index([bomId])
  @@index([productId])
  @@index([componentId])
}

model ProductionOrder {
  id         String @id @default(uuid())
  tenantId   String
  companyId  String
  locationId String

  orderNumber String
  productId   String
  quantity    Decimal @db.Decimal(10, 2)
  unit        String

  // Durum: 'pending', 'in_progress', 'completed', 'cancelled'
  status String @default("pending")

  // Tarihler
  plannedStartDate DateTime?
  plannedEndDate   DateTime?
  actualStartDate  DateTime?
  actualEndDate    DateTime?

  // Maliyet
  estimatedCost Decimal? @db.Decimal(10, 2)
  actualCost    Decimal? @db.Decimal(10, 2)

  // Metadata
  notes    String?
  // Priority: 'low', 'normal', 'high', 'urgent'
  priority String  @default("normal")

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  location        Location         @relation(fields: [locationId], references: [id])
  product         Product          @relation(fields: [productId], references: [id])
  productionSteps ProductionStep[]

  @@unique([tenantId, orderNumber])
  @@index([tenantId, companyId])
  @@index([tenantId, companyId, status])
  @@index([tenantId, companyId, isActive])
  @@index([tenantId, companyId, priority])
  @@index([locationId])
  @@index([productId])
  @@index([status])
  @@index([orderNumber])
}

model ProductionStep {
  id        String @id @default(uuid())
  tenantId  String
  companyId String
  orderId   String

  stepNumber  Int
  name        String
  description String?

  // Durum: 'pending', 'in_progress', 'completed', 'cancelled'
  status String @default("pending")

  // Tarihler
  plannedStart DateTime?
  plannedEnd   DateTime?
  actualStart  DateTime?
  actualEnd    DateTime?

  // İşçilik
  assignedTo String? // User ID
  laborHours Decimal? @db.Decimal(10, 2)

  // Metadata
  notes String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  order ProductionOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([tenantId, companyId])
  @@index([tenantId, companyId, status])
  @@index([orderId])
  @@index([orderId, status])
  @@index([assignedTo])
  @@index([status])
}

model StockMovement {
  id         String  @id @default(uuid())
  tenantId   String
  companyId  String
  locationId String?
  productId  String

  type     String // 'in', 'out', 'transfer', 'adjustment'
  quantity Decimal @db.Decimal(10, 2)
  unit     String

  // Referans
  referenceType String? // 'production', 'sale', 'purchase', 'maintenance'
  referenceId   String?

  // Tarih
  movementDate DateTime @default(now())

  // Metadata
  notes String?

  createdAt DateTime @default(now())

  // Relations
  product Product @relation(fields: [productId], references: [id])

  @@index([tenantId, companyId])
  @@index([tenantId, companyId, type])
  @@index([tenantId, companyId, movementDate])
  @@index([productId])
  @@index([productId, type])
  @@index([locationId])
  @@index([type])
  @@index([movementDate])
  @@index([referenceType, referenceId])
}




// From: modules/real-estate/real-estate.prisma
// ============================================
// Real Estate Module
// ============================================

model Location {
  id        String  @id @default(uuid())
  tenantId  String
  companyId String
  parentId  String? // Hiyerarşi için

  name        String
  type        String // 'firma', 'lokasyon', 'isletme', 'koridor', 'oda'
  code        String?
  description String?

  // Adres bilgileri
  address    String?
  city       String?
  country    String?
  postalCode String?

  // Konum bilgileri (Harita için)
  latitude  Decimal? @db.Decimal(10, 8)
  longitude Decimal? @db.Decimal(11, 8)

  // Metadata
  metadata Json?

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  parent             Location?           @relation("LocationHierarchy", fields: [parentId], references: [id], onDelete: SetNull)
  children           Location[]          @relation("LocationHierarchy")
  equipment          Equipment[]
  products           Product[]
  productionOrders   ProductionOrder[]
  maintenanceRecords MaintenanceRecord[]

  @@index([tenantId, companyId])
  @@index([tenantId, companyId, isActive])
  @@index([tenantId, companyId, type])
  @@index([parentId])
  @@index([type])
  @@index([isActive])
  @@index([latitude, longitude])
}

model Property {
  id        String @id @default(uuid())
  tenantId  String
  companyId String

  // Temel bilgiler
  name String // Apartman/Kompleks adı
  type String // 'apartment', 'complex', 'building'
  code String? // Özel kod

  // Adres bilgileri (Anschrift)
  address      String
  city         String
  district     String? // İlçe
  neighborhood String? // Mahalle
  street       String? // Sokak / Straße
  buildingNo   String? // Bina no / Hausnummer
  postalCode   String? // Postleitzahl
  country      String  @default("TR")
  propertyNumber String? // Steinr. (Taşınmaz Numarası)

  // Konum bilgileri (Harita için)
  latitude  Decimal? @db.Decimal(10, 8)
  longitude Decimal? @db.Decimal(11, 8)

  // Yönetim bilgileri
  totalUnits    Int     @default(0) // Toplam daire sayısı / Anzahl Wohneinheiten
  managerId     String? // Yönetici personel ID
  managerUserId String? // Yönetici kullanıcı ID (sistem içi)

  // Aidat yönetimi
  monthlyFee Decimal? @db.Decimal(10, 2) // Aylık aidat
  paymentDay Int? // Ödeme günü (1-31)

  // Master Data (Stammdaten)
  constructionYear   Int?      // Baujahr (Yapım Yılı)
  lastRenovationDate DateTime? // Letzte durchgeführte Renovierung (Son Yenileme Tarihi)
  landArea           Decimal?  @db.Decimal(10, 2) // Grundstücksfläche m² (Arsa Alanı)
  floorCount         Int? // Anzahl Etagen (Kat Sayısı)
  livingArea         Decimal?  @db.Decimal(10, 2) // Wohnfläche m² (Yaşam Alanı)

  // Purchase Information (Erwerbsinformationen)
  purchaseDate  DateTime? // Kaufdatum (Satın Alma Tarihi)
  purchasePrice Decimal?  @db.Decimal(12, 2) // Kaufpreis (Satın Alma Fiyatı)
  isPaidOff     Boolean   @default(false) // Abbezahlt (Ödendi)

  // Financing (Finanzierung)
  financingStartDate   DateTime? // Startdatum der Finanzierung (Finansman Başlangıç Tarihi)
  financingEndDate     DateTime? // Enddatum der Finanzierung (Finansman Bitiş Tarihi)
  monthlyFinancingRate Decimal?  @db.Decimal(10, 2) // Monatliche Finanzierungsrate (Aylık Finansman Taksiti)
  numberOfInstallments Int? // Anzahl der Raten (Taksit Sayısı)
  financingPaymentDay  Int? // Tag der Abbuchung (Finansman Taksit Günü 1-31)

  // Metadata
  description String?
  images      String[] // Merkezi Dosya Yönetimi'nden
  coverImage  String? // Kapak resmi
  documents   String[] // Merkezi Dosya Yönetimi'nden
  metadata    Json? // Ek bilgiler

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  apartments      Apartment[]
  staff           PropertyStaff[]
  expenses        PropertyExpense[]
  reconciliations SideCostReconciliation[]

  @@index([tenantId, companyId])
  @@index([tenantId, companyId, isActive])
  @@index([tenantId, companyId, city])
  @@index([city, district])
  @@index([latitude, longitude])
}

model Apartment {
  id         String @id @default(uuid())
  tenantId   String
  companyId  String
  propertyId String

  // Temel bilgiler
  unitNumber String // Daire no (örn: "A-101")
  floor      Int? // Kat
  block      String? // Blok

  // Özellikler
  area          Decimal @db.Decimal(10, 2) // Metrekare / Wohnfläche m²
  roomCount     Int // Oda sayısı (3+1 için 3) / Anzahl Zimmer
  livingRoom    Boolean @default(true) // Salon var mı
  bathroomCount Int     @default(1) // Banyo sayısı / Badezimmer
  balcony       Boolean @default(false) // Balkon var mı

  // Type and Additional Rooms
  apartmentType String? // Wohnungstyp (Daire Tipi)
  bedroomCount  Int?    @default(0) // Schlafzimmer (Yatak Odası Sayısı)
  basementSize  Decimal? @db.Decimal(8, 2) // Kellergröße (Kiler Boyutu)

  // Renovation and Internet
  lastRenovationDate DateTime? // Datum letzter Renovierung (Son Yenileme Tarihi)
  internetSpeed      String? // Internetgeschwindigkeit (İnternet Hızı)

  // Heating Systems (Heizungssysteme) - up to 4 systems
  heatingSystems Json? // Array of heating system objects

  // Monthly Costs (Monatliche Kosten)
  coldRent        Decimal? @db.Decimal(10, 2) // Kaltmiete (Net Kira)
  additionalCosts Decimal? @db.Decimal(10, 2) // Nebenkosten (Ek/Yan Giderler)
  heatingCosts    Decimal? @db.Decimal(10, 2) // Heizkosten (Isıtma Giderleri)
  deposit         Decimal? @db.Decimal(10, 2) // Kaution (Depozito)

  // Usage Rights (Nutzungsrechte für die Mieteinheit)
  usageRights Json? // Array of usage rights objects

  // Mülkiyet bilgisi
  ownerId       String? // Sahip ID (Contact/User)
  ownerType     String? // 'person', 'company', 'state', 'foundation'
  ownershipType String? // 'full', 'shared', 'leasehold'

  // Durum
  status       String    @default("empty") // 'empty', 'rented', 'sold', 'maintenance'
  deliveryDate DateTime? // Teslim tarihi

  // Finansal
  rentPrice Decimal? @db.Decimal(10, 2) // Kira bedeli
  salePrice Decimal? @db.Decimal(10, 2) // Satış fiyatı

  // Demirbaş listesi
  inventory Json? // InventoryItem[]

  // Dijital anahtar
  keys Json? // KeyInfo[]

  // Metadata
  description String?
  images      String[] // Merkezi Dosya Yönetimi'nden
  coverImage  String? // Kapak resmi
  documents   String[] // Merkezi Dosya Yönetimi'nden
  metadata    Json? // Ek bilgiler

  // QR Kod
  qrCode String? // QR kod string

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  property         Property                      @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  contracts        Contract[]
  appointments     Appointment[]
  payments         Payment[]
  maintenance      RealEstateMaintenanceRecord[]
  agreementReports AgreementReport[]

  @@unique([propertyId, unitNumber])
  @@index([tenantId, companyId])
  @@index([tenantId, companyId, status])
  @@index([tenantId, companyId, isActive])
  @@index([propertyId])
  @@index([propertyId, status])
  @@index([status])
  @@index([unitNumber])
}

model Tenant {
  id        String @id @default(uuid())
  tenantId  String // Tenant ID (multi-tenant)
  companyId String

  // Kişi bilgileri (Merkezi Contact/User servisinden)
  userId    String? // Sistem kullanıcısı ID (opsiyonel)
  contactId String? // Merkezi Contact ID

  // Kiracı özel bilgileri
  tenantNumber String? // Kiracı numarası / Mieter Number
  moveInDate   DateTime? // Taşınma tarihi / Einzugsdatum
  moveOutDate  DateTime? // Çıkış tarihi / Auszugsdatum

  // Type (Mietertyp)
  tenantType  String? // 'person' or 'company'
  companyName String? // Unternehmensname (Optional - for company type)

  // Personal Information (for person type)
  salutation String? // Anrede: 'Herr' or 'Frau'
  firstName  String? // Vorname (Ad)
  lastName   String? // Nachname (Soyad)
  birthDate  DateTime? // Geburtsdatum (Doğum Tarihi)
  birthPlace String? // Geburtsort (Doğum Yeri)

  // Address (Anschrift)
  street      String? // Straße (Cadde/Sokak)
  houseNumber String? // Hausnummer (Bina Numarası)
  postalCode  String? // Postleitzahl (Posta Kodu)
  city        String? // Stadt (Şehir)

  // Contact Information
  phone  String? // Festnetz Telefonnummer (Sabit Hat)
  mobile String? // Mobile Telefonnummer (Cep Telefonu)
  email  String? // E-Mail-Adresse

  // Additional Information
  nationality String? // Staatsangehörigkeit (Vatandaşlık)
  taxNumber   String? // Steuernummer (Vergi Numarası)

  // Analitik profiller
  paymentScore     Decimal? @default(100) @db.Decimal(5, 2) // Ödeme düzeni puanı (0-100)
  contactScore     Decimal? @default(100) @db.Decimal(5, 2) // İletişim puanı (0-100)
  maintenanceScore Decimal? @default(100) @db.Decimal(5, 2) // Bakım puanı (0-100)
  overallScore     Decimal? @default(100) @db.Decimal(5, 2) // Genel puan

  // Notlar ve analiz
  notes    String?
  analysis Json? // Analiz notları

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  contracts    Contract[]
  payments     Payment[]
  appointments Appointment[]

  @@index([tenantId, companyId])
  @@index([tenantId, companyId, isActive])
  @@index([userId])
  @@index([contactId])
}

model Contract {
  id             String  @id @default(uuid())
  tenantId       String
  companyId      String
  apartmentId    String
  tenantRecordId String // Tenant model ID
  templateId     String? // ContractTemplate ID (opsiyonel)

  // Sözleşme bilgileri
  contractNumber String // Sözleşme numarası
  type           String // 'rental', 'sale', 'lease'

  // Tarihler
  startDate   DateTime
  endDate     DateTime?
  renewalDate DateTime? // Yenileme tarihi

  // Finansal
  rentAmount Decimal  @db.Decimal(10, 2) // Kira bedeli
  deposit    Decimal? @db.Decimal(10, 2) // Depozito
  currency   String   @default("TRY")

  // Ödeme bilgileri
  paymentType String? // 'cash', 'bank_transfer', 'auto_debit'
  paymentDay  Int? // Ödeme günü (1-31)

  // Otomasyon
  autoRenewal       Boolean  @default(false)
  renewalNoticeDays Int?     @default(30) // Yenileme bildirimi (gün önceden)
  increaseRate      Decimal? @db.Decimal(5, 4) // Zam oranı (0.15 = %15)

  // Durum
  status String @default("active") // 'draft', 'active', 'expired', 'terminated'

  // Evraklar
  documents String[] // Merkezi Dosya Yönetimi'nden (sözleşme, kimlik, vb.)

  // Metadata
  terms String? // Özel şartlar
  notes String?

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  apartment        Apartment         @relation(fields: [apartmentId], references: [id])
  tenantRecord     Tenant            @relation(fields: [tenantRecordId], references: [id])
  template         ContractTemplate? @relation(fields: [templateId], references: [id])
  payments         Payment[]
  agreementReports AgreementReport[]

  @@unique([tenantId, contractNumber])
  @@index([tenantId, companyId])
  @@index([tenantId, companyId, status])
  @@index([tenantId, companyId, isActive])
  @@index([apartmentId])
  @@index([apartmentId, status])
  @@index([tenantRecordId])
  @@index([templateId])
  @@index([status])
  @@index([startDate, endDate])
}

model Payment {
  id             String  @id @default(uuid())
  tenantId       String  // Multi-tenant firma ID (core tenant)
  companyId      String
  apartmentId    String
  contractId     String?
  tenantRecordId String? // Kiracı kişi ID (RETenant) - opsiyonel

  // Ödeme bilgileri
  type     String // 'rent', 'deposit', 'fee', 'maintenance', 'utility'
  amount   Decimal @db.Decimal(10, 2)
  currency String  @default("TRY")

  // Tarihler
  dueDate  DateTime // Vade tarihi
  paidDate DateTime? // Ödeme tarihi

  // Durum
  status String @default("pending") // 'pending', 'paid', 'overdue', 'cancelled'

  // Ek giderler
  extraCharges Json? // ExtraCharge[] (aidat, elektrik, su, vb.)
  totalAmount  Decimal @db.Decimal(10, 2) // Toplam tutar (rent + extraCharges)

  // Ödeme detayları
  paymentMethod String? // 'cash', 'bank_transfer', 'card', 'check'
  receiptNumber String? // Makbuz numarası
  notes         String?

  // Otomasyon
  isAutoGenerated Boolean @default(false) // Otomatik oluşturuldu mu
  reminderSent    Boolean @default(false) // Hatırlatma gönderildi mi

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  apartment    Apartment @relation(fields: [apartmentId], references: [id])
  contract     Contract? @relation(fields: [contractId], references: [id])
  tenantRecord Tenant?   @relation(fields: [tenantRecordId], references: [id])

  @@index([tenantId, companyId])
  @@index([tenantId, companyId, status])
  @@index([tenantId, companyId, dueDate])
  @@index([tenantId, status, dueDate])
  @@index([apartmentId])
  @@index([apartmentId, status])
  @@index([contractId])
  @@index([tenantRecordId])
  @@index([status])
  @@index([dueDate])
  @@index([paidDate])
}

model Appointment {
  id             String  @id @default(uuid())
  tenantId       String  // Multi-tenant firma ID (core tenant)
  companyId      String
  apartmentId    String?
  tenantRecordId String? // Kiracı kişi ID (RETenant) - opsiyonel

  // Randevu bilgileri
  type        String // 'viewing', 'delivery', 'maintenance', 'inspection', 'meeting'
  title       String
  description String?

  // Tarih ve saat
  startDate DateTime
  endDate   DateTime
  duration  Int? // Dakika cinsinden

  // Katılımcılar
  staffIds             String[] // Personel ID'leri (sistem içi veya modül içi)
  externalParticipants Json? // Dış katılımcılar (isim, telefon, email)

  // Durum
  status String @default("scheduled") // 'scheduled', 'completed', 'cancelled', 'no_show'

  // Takip
  followUpRequired Boolean   @default(false)
  followUpDate     DateTime?
  followUpNotes    String?

  // Sonuç (randevu sonrası)
  result        Json? // AppointmentResult
  rating        Int? // 1-5 yıldız (görücü için)
  interestLevel String? // 'high', 'medium', 'low'

  // Metadata
  location String? // Randevu yeri
  notes    String?

  // Calendar entegrasyonu
  calendarEventId String? // Merkezi Calendar event ID

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  apartment        Apartment?        @relation(fields: [apartmentId], references: [id])
  tenantRecord     Tenant?           @relation(fields: [tenantRecordId], references: [id])
  agreementReports AgreementReport[]

  @@index([tenantId, companyId])
  @@index([tenantId, companyId, status])
  @@index([tenantId, companyId, startDate])
  @@index([apartmentId])
  @@index([tenantRecordId])
  @@index([type])
  @@index([startDate])
  @@index([status])
}

model RealEstateStaff {
  id        String @id @default(uuid())
  tenantId  String
  companyId String

  // Personel bilgileri
  userId String? // Sistem kullanıcısı ID (sistem içi personel)
  name   String // Modül içi personel için isim
  email  String?
  phone  String?

  // Personel tipi
  staffType String // 'internal' (sistem kullanıcısı) | 'external' (modül içi)

  // Rol ve yetkiler
  role        String // 'manager', 'agent', 'accountant', 'maintenance', 'observer'
  permissions Json? // Özel izinler

  // Atama
  propertyIds  String[] // Sorumlu olduğu property'ler
  apartmentIds String[] // Sorumlu olduğu daireler

  // Performans metrikleri
  assignedUnits        Int      @default(0) // Sorumlu olduğu daire sayısı
  collectionRate       Decimal? @db.Decimal(5, 2) // Tahsilat oranı (%)
  averageVacancyDays   Decimal? @db.Decimal(10, 2) // Ortalama boş kalma süresi (gün)
  customerSatisfaction Decimal? @db.Decimal(5, 2) // Müşteri memnuniyeti (0-100)

  // Metadata
  notes String?
  profileImage String? // Profil resmi (Merkezi Dosya Yönetimi'nden)

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  properties PropertyStaff[]

  @@unique([tenantId, userId])
  @@index([tenantId, companyId])
  @@index([userId])
  @@index([staffType])
  @@index([role])
}

model PropertyStaff {
  id         String @id @default(uuid())
  tenantId   String
  companyId  String
  propertyId String
  staffId    String

  // Atama bilgileri
  role      String? // Bu property'deki rolü
  startDate DateTime  @default(now())
  endDate   DateTime?

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  property Property        @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  staff    RealEstateStaff @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@unique([propertyId, staffId])
  @@index([tenantId, companyId])
  @@index([propertyId])
  @@index([staffId])
}

model RealEstateMaintenanceRecord {
  id          String @id @default(uuid())
  tenantId    String
  companyId   String
  apartmentId String

  // Bakım bilgileri
  type        String // 'preventive', 'corrective', 'emergency'
  title       String
  description String?

  // Durum
  status String @default("scheduled") // 'scheduled', 'in_progress', 'completed', 'cancelled'

  // Tarihler
  scheduledDate DateTime
  startDate     DateTime?
  endDate       DateTime?

  // Personel
  assignedStaffId    String? // RealEstateStaff ID
  performedByStaffId String? // RealEstateStaff ID

  // Maliyet
  estimatedCost Decimal? @db.Decimal(10, 2)
  actualCost    Decimal? @db.Decimal(10, 2)

  // Dokümanlar
  documents String[] // Merkezi Dosya Yönetimi'nden
  photos    String[] // Merkezi Dosya Yönetimi'nden

  // Metadata
  notes String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  apartment Apartment @relation(fields: [apartmentId], references: [id])

  @@index([tenantId, companyId])
  @@index([tenantId, companyId, status])
  @@index([tenantId, companyId, scheduledDate])
  @@index([apartmentId])
  @@index([status])
  @@index([scheduledDate])
}

model BulkOperation {
  id        String @id @default(uuid())
  tenantId  String
  companyId String
  createdBy String // User ID

  // İşlem bilgileri
  type        String // 'rent_increase', 'fee_update', 'status_update', 'contract_renewal', 'payment_generate', 'custom'
  title       String
  description String?

  // Sonuçlar
  affectedCount Int    @default(0)
  successCount  Int    @default(0)
  failedCount   Int    @default(0)
  status        String @default("pending") // 'pending', 'processing', 'completed', 'failed', 'cancelled'

  // Parametreler ve sonuçlar
  parameters Json // Operation-specific parameters
  results    Json? // Operation results

  // Tarihler
  startedAt   DateTime?
  completedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  createdByUser User @relation(fields: [createdBy], references: [id], onDelete: Cascade)

  @@index([tenantId, companyId])
  @@index([type])
  @@index([status])
  @@index([createdBy])
  @@index([createdAt])
}

model ContractTemplate {
  id        String  @id @default(uuid())
  tenantId  String
  companyId String?

  // Şablon bilgileri
  name        String
  description String?
  type        String // 'rental', 'sale', 'lease', 'general'
  category    String? // 'standard', 'premium', 'custom'

  // İçerik
  content String // HTML/PDF template içeriği (template variables ile)

  // Dinamik alanlar
  variables Json? // TemplateVariable[] - Kullanılabilir değişkenler

  // Metadata
  isDefault Boolean @default(false)
  isActive  Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  contracts Contract[]

  @@unique([tenantId, name])
  @@index([tenantId, companyId])
  @@index([type])
  @@index([category])
  @@index([isDefault])
  @@index([isActive])
}

model EmailTemplate {
  id        String  @id @default(uuid())
  tenantId  String
  companyId String?

  // Şablon bilgileri
  name     String
  category String // 'promotion', 'announcement', 'reminder', 'welcome', 'agreement'
  subject  String // E-posta konusu

  // İçerik
  htmlContent String // HTML içerik (template variables ile)
  textContent String? // Plain text alternatifi

  // Dinamik alanlar
  variables Json? // TemplateVariable[]

  // Metadata
  isDefault Boolean @default(false)
  isActive  Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  campaigns EmailCampaign[]

  @@unique([tenantId, name])
  @@index([tenantId, companyId])
  @@index([category])
}

model EmailCampaign {
  id          String  @id @default(uuid())
  tenantId    String
  companyId   String
  templateId  String
  apartmentId String? // İlişkili daire

  // Kampanya bilgileri
  name String

  // Alıcılar
  recipients     Json // Recipient[]
  recipientCount Int  @default(0)

  // İçerik özelleştirme
  customContent Json? // Özelleştirilmiş içerik

  // Zamanlama
  scheduledAt DateTime?
  sentAt      DateTime?

  // Durum
  status String @default("draft") // 'draft', 'scheduled', 'sending', 'sent', 'failed'

  // Analitik
  sentCount       Int @default(0)
  openedCount     Int @default(0)
  clickedCount    Int @default(0)
  conversionCount Int @default(0)

  // Metadata
  notes String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  template EmailTemplate @relation(fields: [templateId], references: [id])

  @@index([tenantId, companyId])
  @@index([templateId])
  @@index([apartmentId])
  @@index([status])
}

model AgreementReport {
  id            String  @id @default(uuid())
  tenantId      String
  companyId     String
  appointmentId String? // İlişkili randevu

  // Rapor bilgileri
  type        String // 'boss', 'owner', 'tenant', 'internal'
  apartmentId String
  contractId  String?

  // Anlaşma detayları
  agreementStatus String // 'pre_agreement', 'signed', 'delivery_scheduled', 'deposit_received'
  rentAmount      Decimal?  @db.Decimal(10, 2)
  deposit         Decimal?  @db.Decimal(10, 2)
  deliveryDate    DateTime?
  contractDate    DateTime?

  // Özel şartlar
  specialTerms String?
  nextSteps    String?

  // Alıcılar
  recipients Json // Recipient[]

  // Ek dosyalar
  attachments String[] // Merkezi Dosya Yönetimi'nden

  // Durum
  status String    @default("draft") // 'draft', 'sent', 'viewed'
  sentAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  apartment  Apartment   @relation(fields: [apartmentId], references: [id])
  contract   Contract?   @relation(fields: [contractId], references: [id])
  appointment Appointment? @relation(fields: [appointmentId], references: [id])

  @@index([tenantId, companyId])
  @@index([appointmentId])
  @@index([apartmentId])
  @@index([type])
}

model AgreementReportTemplate {
  id        String  @id @default(uuid())
  tenantId  String
  companyId String?

  // Şablon bilgileri
  name        String
  category    String // 'boss', 'owner', 'tenant', 'internal'
  description String?

  // İçerik
  content String // HTML/PDF template içeriği

  // Dinamik alanlar
  variables Json? // TemplateVariable[]

  // Metadata
  isDefault Boolean @default(false)
  isActive  Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([tenantId, name])
  @@index([tenantId, companyId])
  @@index([category])
  @@index([isDefault])
  @@index([isActive])
}

// ============================================
// YAN GİDER (NEBENKOSTEN) SİSTEMİ
// ============================================

// Gayrimenkul (Bina) Giderleri
model PropertyExpense {
  id         String @id @default(uuid())
  tenantId   String
  companyId  String
  propertyId String

  // Gider bilgileri
  name        String // Gider adı (örn: "Ortak alan elektriği")
  category    String // utilities, maintenance, insurance, taxes, management, cleaning, heating, other
  amount      Decimal  @db.Decimal(12, 2)
  expenseDate DateTime // Gider tarihi
  year        Int // Yıl (raporlama için)
  month       Int? // Ay (opsiyonel)

  // Detaylar
  description String? // Açıklama
  receiptUrl  String? // Fatura/Makbuz URL
  invoiceNumber String? // Fatura numarası
  vendorName  String? // Tedarikçi adı

  // Dağıtım
  isDistributed      Boolean @default(false) // Dairelere dağıtıldı mı?
  distributionMethod String? // equal, area_based, custom
  distributedAt      DateTime?

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([tenantId, companyId])
  @@index([propertyId])
  @@index([year])
  @@index([year, month])
  @@index([category])
  @@index([isDistributed])
}

// Yıl Sonu Uzlaştırma
model SideCostReconciliation {
  id         String @id @default(uuid())
  tenantId   String
  companyId  String
  propertyId String
  year       Int

  // Hesaplama bilgileri
  totalExpenses     Decimal @db.Decimal(12, 2) // Toplam giderler
  apartmentCount    Int // Daire sayısı
  perApartmentShare Decimal @db.Decimal(12, 2) // Daire başı pay (eşit dağılım)

  // Dağıtım yöntemi
  distributionMethod String // equal, area_based, custom

  // Mali yıl (özel dönem seçeneği)
  fiscalYearStart DateTime? // Varsayılan: 1 Ocak
  fiscalYearEnd   DateTime? // Varsayılan: 31 Aralık

  // Durum
  status       String    @default("draft") // draft, calculated, finalized, cancelled
  calculatedAt DateTime?
  finalizedAt  DateTime?
  finalizedBy  String? // User ID

  // Detay bilgileri (her dairenin hesaplaması)
  details Json // ReconciliationApartmentDetail[]

  // Notlar
  notes String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@unique([propertyId, year])
  @@index([tenantId, companyId])
  @@index([propertyId])
  @@index([year])
  @@index([status])
}

// ============================================
// KULLANIM HAKLARI (NUTZUNGSRECHTE) SİSTEMİ
// ============================================

// Master list - Admin tarafından yönetilen kullanım hakları listesi
model UsageRight {
  id        String @id @default(uuid())
  tenantId  String
  companyId String?

  // Temel bilgiler
  name      String // Kullanım hakkı adı (örn: "Stellplatz", "Balkon")
  nameEn    String? // İngilizce adı
  nameTr    String? // Türkçe adı
  category  String // parking, heating, security, technology, bathroom, outdoor, storage, accessibility, flooring, energy

  // Sıralama ve görünüm
  sortOrder Int @default(0) // Sıralama (tablo görünümü için)
  icon      String? // İkon adı (opsiyonel)

  // Açıklama
  description   String?
  descriptionEn String?
  descriptionTr String?

  // Varsayılan olarak aktif mi?
  isDefaultActive Boolean @default(false)

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([tenantId, name])
  @@index([tenantId, companyId])
  @@index([tenantId, category])
  @@index([category])
  @@index([sortOrder])
  @@index([isActive])
}




// From: modules/web-builder/web-builder.prisma
// ============================================
// Web Builder Module
// ============================================

model Website {
  id        String   @id @default(uuid())
  tenantId  String
  companyId String
  name      String
  domain    String?  @unique
  status    String   @default("draft") // draft, published, archived
  themeId   String?
  favicon   String?
  settings  Json? // Global settings (SEO, analytics, etc.)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  company Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  pages   Page[]
  theme   Theme?         @relation(fields: [themeId], references: [id])
  assets  WebsiteAsset[]
  forms   Form[]

  @@index([tenantId, companyId])
  @@index([domain])
}

model Page {
  id          String  @id @default(uuid())
  tenantId    String
  companyId   String
  websiteId   String
  title       String
  slug        String
  description String?
  status      String  @default("draft") // draft, published, archived
  isHome      Boolean @default(false)
  settings    Json? // SEO, social share, etc.

  // SEO fields
  metaTitle       String?
  metaDescription String?
  metaKeywords    String[] // SEO keywords array

  // Publishing
  publishedAt DateTime?

  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  website  Website       @relation(fields: [websiteId], references: [id], onDelete: Cascade)
  sections PageSection[]

  @@unique([websiteId, slug])
  @@index([tenantId, companyId])
  @@index([websiteId])
  @@index([status])
  @@index([publishedAt])
}

model PageSection {
  id        String   @id @default(uuid())
  tenantId  String
  companyId String
  pageId    String
  type      String // header, footer, hero, features, etc.
  order     Int
  settings  Json? // Background, padding, etc.
  content   Json? // Specific content for the section
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  page     Page          @relation(fields: [pageId], references: [id], onDelete: Cascade)
  elements PageElement[]

  @@index([tenantId, companyId])
  @@index([pageId])
}

model PageElement {
  id        String   @id @default(uuid())
  tenantId  String
  companyId String
  sectionId String
  type      String // text, image, button, video, etc.
  order     Int
  content   Json? // Text content, image URL, etc.
  settings  Json? // Styles, animation, etc.
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  section PageSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)

  @@index([tenantId, companyId])
  @@index([sectionId])
}

model Theme {
  id          String   @id @default(uuid())
  tenantId    String
  companyId   String
  name        String
  description String?
  config      Json // Colors, typography, spacing, etc.
  isSystem    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  websites Website[]

  @@index([tenantId, companyId])
  @@index([name])
}

model Template {
  id          String   @id @default(uuid())
  tenantId    String? // Tenant-specific templates (null for system templates)
  companyId   String
  name        String
  description String?
  thumbnail   String?
  category    String?
  structure   Json // Full page/website structure
  isSystem    Boolean  @default(false)
  isPublic    Boolean  @default(false) // Public templates available to all tenants
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([tenantId])
  @@index([category])
  @@index([isPublic])
  @@index([isActive])
}

model Form {
  id        String   @id @default(uuid())
  tenantId  String
  companyId String
  websiteId String
  name      String
  fields    Json // Array of field definitions
  settings  Json? // Email notifications, success message, etc.
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  website     Website          @relation(fields: [websiteId], references: [id], onDelete: Cascade)
  submissions FormSubmission[]

  @@index([tenantId, companyId])
  @@index([websiteId])
}

model FormSubmission {
  id        String   @id @default(uuid())
  tenantId  String
  companyId String
  formId    String
  data      Json // Submitted data
  metadata  Json? // IP, user agent, etc.
  status    String   @default("new") // new, read, spam
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  form Form @relation(fields: [formId], references: [id], onDelete: Cascade)

  @@index([tenantId, companyId])
  @@index([formId])
}

model WebsiteAsset {
  id        String   @id @default(uuid())
  tenantId  String
  companyId String
  websiteId String
  name      String
  url       String
  type      String // image, video, document
  size      Int?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  website Website @relation(fields: [websiteId], references: [id], onDelete: Cascade)

  @@index([tenantId, companyId])
  @@index([websiteId])
}

model BrandKit {
  id           String   @id @default(uuid())
  tenantId     String
  companyId    String   @unique
  logoUrl      String?
  colorPalette Json? // { primary: "#...", secondary: "#...", etc. }
  fontFamily   String?
  toneOfVoice  String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([tenantId, companyId])
}

model Asset {
  id          String   @id @default(uuid())
  tenantId    String
  companyId   String
  url         String
  tags        String[] // Array of tag strings
  name        String?
  description String?
  fileType    String?
  fileSize    Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([tenantId, companyId])
}

model Content {
  id            String    @id @default(uuid())
  tenantId      String
  companyId     String
  status        String // draft, scheduled, published, archived
  caption       String?
  mediaUrl      String?
  scheduledDate DateTime?
  publishedDate DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([tenantId, companyId])
  @@index([status])
  @@index([scheduledDate])
}

model Finance {
  id          String   @id @default(uuid())
  tenantId    String
  companyId   String
  amount      Decimal  @db.Decimal(10, 2)
  type        String // income, expense, etc.
  description String?
  date        DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([tenantId, companyId])
  @@index([type])
  @@index([date])
}



